<apex:page id="appContractWizardPage" standardController="Lending_Application__c" 
           extensions="LendingAppContractWizardController" tabStyle="Lending_Application__c"
           standardStylesheets="true" showHeader="{!NOT(mWizardLayout.mIsFullScreenMode)}"
           sidebar="{!NOT(mWizardLayout.mIsFullScreenMode)}" 
           title="{!mPageTitle} : {!mPageSubTitle}">  

    <head>
        <meta http-equiv="x-ua-compatible" content="ie=edge"/>
        <apex:slds />
        <apex:stylesheet value="{!URLFOR($Resource.fs_style, 'fs-style.css')}"/>
        <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" />
        <script src="{!URLFOR($Resource.fs_svg, 'svg4everybody.js')}"/>
        <script>var $j = jQuery.noConflict();</script>
    </head>
    
    <body>
        <div class="slds-scope">
            <apex:form styleClass="fs-data-form slds-form--stacked slds-m-horizontal_x-small" rendered="{!$ObjectType.Lending_Application__c.accessible}">

                <c:wizardPageHeader parentRecordId="{!mApplication.Id}"
                                    iconStyleClass="slds-icon slds-icon--large slds-icon-standard-apps"
                                    iconPath="{!URLFOR($Asset.SLDS, 'assets/icons/custom-sprite/svg/symbols.svg#custom18')}"
                                    pageTitle="{!mPageTitle}"
                                    pageSubTitle="{!mPageSubTitle}"
                                    recordTitle="{!mApplication.Title__c}"
                                    recordTitleBadge="{!$Label.fscore__title_badge}"
                                    previousAction="{!onPrevious}"
                                    renderPrevious="{!hasPrevious}"
                                    nextAction="{!onNext}"
                                    renderNext="{!hasNext}"
                                    saveAction="{!onSave}"
                                    renderSave="true"
                                    saveAndReturnAction="{!onSaveAndReturn}"
                                    cancelAction="{!onCancel}"
                                    wizardSectionList="{!mWizardSectionList}"
                                    directNavigationWarning="{!mWizardLayout.mShowDirectNavigationWarning}"/>

                <apex:outputPanel id="messagePanel" styleClass="fs-message-panel">
                    <apex:pageMessages ></apex:pageMessages>
                </apex:outputPanel>
    
                <apex:actionStatus id="waitActionStatus">
                    <apex:facet name="start">
                        <c:fsSpinner spinnerSize="medium"/>
                    </apex:facet>
                </apex:actionStatus>
        
                <div class="slds-m-vertical--small">
                    <div class="slds-theme--default slds-container--fluid">
                        <c:pageMessage messageTitle="{!$Label.fscore__invalid_access}" 
                                       messageDetail="{!$Label.fscore__contract_info_invalid_access_message}" 
                                       rendered="{!ISBLANK(mApplication.Id)}"
                                       backgroundTheme="default"
                                       iconTheme="slds-icon-text-error"
                                       iconType="assets/icons/utility-sprite/svg/symbols.svg#error"/>
        
                        <apex:outputPanel id="iEditContractInfoPanel" rendered="{!NOT(ISBLANK(mApplication.Id))}">

                            <!--
                            <div class="slds-grid slds-grid--align-spread slds-m-bottom--small">
                                <div class="slds-col">
                                    <h3><span class="slds-text-heading--small" style="color: #16325c;">
                                        <strong>{!$Label.fscore__contract_info_edit_section_title}</strong>
                                    </span></h3>
                                </div>
                            </div>
                            -->

                            <apex:pageBlock id="iContractInfoBlock" mode="maindetail" html-class="fs-data-block">
                                <div class="slds-tabs--scoped">
                                    <!--Tabs -->
                                    <ul class="slds-tabs--scoped__nav" role="tablist">
                                        <li id="applyTemplateTab" class="slds-tabs--scoped__item slds-text-heading--label slds-active"
                                            title="Apply Contract Template" role="presentation">
                                            <a id="applyTemplateTabLabel" class="slds-tabs--scoped__link" href="#void" role="tab" tabindex="0"
                                               aria-selected="false" aria-controls="applyTemplateTabContent">
                                               Apply Contract Template
                                            </a>
                                        </li>
        
                                        <li id="calcRepaymentTab" class="slds-tabs--scoped__item slds-text-heading--label"
                                            title="Enter contract details and calculate Repayment" role="presentation">
                                            <a id="calcRepaymentTabLabel" class="slds-tabs--scoped__link" href="#void" role="tab" tabindex="-1" 
                                               aria-selected="true" aria-controls="calcRepaymentTabContent">
                                                Calculate Repayment
                                            </a>
                                        </li>
        
                                        <li id="repayDetailTab" class="slds-tabs--scoped__item slds-text-heading--label"
                                            title="View Repayment Details" role="presentation">
                                            <a id="repayDetailTabLabel" class="slds-tabs--scoped__link" href="#void" role="tab" tabindex="-1" 
                                               aria-selected="true" aria-controls="repayDetailTabContent">
                                                Repayment Details
                                            </a>
                                        </li>
        
                                    </ul>
                                    <!-- / Tabs -->
        
                                    <!-- Apply Template -->
                                    <div id="applyTemplateTabContent" class="slds-tabs--scoped__content slds-show"
                                         role="tabpanel" aria-labelledby="applyTemplateTabLabel">
        
                                        <apex:pageBlockSection id="iContractTemplateInfoSection" collapsible="false" columns="1">
                                            <!-- Contract Template -->
                                            <apex:pageBlockSectionItem id="iContractTemplateName">
                                                <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Contract_Template_Name__c.Label}">
                                                    <apex:outputPanel styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                </apex:outputLabel>
                                        
                                                <apex:outputPanel id="iContractTemplateListPanel">
                                                    <c:actionSelectList value="{!mApplication.Contract_Template_Name__c}"
                                                                        selectOptions="{!mContractTemplateSelectList}"
                                                                        changeAction="{!onContractTemplateChange}"
                                                                        enableChangeAction="true"
                                                                        refreshAction="{!onContractTemplateListRefresh}"
                                                                        enableRefreshAction="true"
                                                                        style="width: auto !important;"
                                                                        reRender="messagePanel,iContractTemplateListPanel"/>
                                                    &nbsp;
                                                    <apex:commandLink rendered="{!NOT(ISBLANK(mApplication.Contract_Template_Name__c))}"
                                                                      type="image/png"
                                                                      title="{!$Label.fscore__view_contract_template_details_tooltip}"
                                                                      reRender="iContractTemplateListPanel"
                                                                      style="align-self: center;"
                                                                      onclick="OpenModalView('/apex/fscore__contractTemplateViewPage?Id={!mApplication.Contract_Template_Name__c}');">
                                                        <apex:image value="{!URLFOR($Resource.fs_slds, 'assets/icons/utility/open_60.png')}"
                                                                    styleClass="fs-action-icon" />
                                                    </apex:commandLink>
                                                    &nbsp;
                                                    <apex:commandButton id="applyContractTemplate" action="{!onContractTemplateApply}"
                                                                        value="{!$Label.fscore__apply_button}"
                                                                        title="{!$Label.fscore__apply_contract_template_message}"
                                                                        styleClass="slds-button slds-button--brand fs-small-button--brand"
                                                                        status="waitActionStatus"
                                                                        oncomplete="setFieldDisplayProperties();"
                                                                        reRender="messagePanel,iContractTemplateListPanel,iContractParamDetailPanel,iItemizationContentPanel,iContractualFeePanel,iPredefinedPmtPanel,iRatePreferencePanel,iPmtPreferencePanel"
                                                                        rendered="{!NOT(ISBLANK(mApplication.Contract_Template_Name__c))}"/>
                                                </apex:outputPanel>
                                            </apex:pageBlockSectionItem>
                                            <!-- / Contract Template -->
                                        </apex:pageBlockSection>
    
                                        <apex:outputPanel id="iItemizationContentPanel">
                                            <!-- Section title -->
                                            <div class="slds-m-top--small">
                                                <div class="slds-grid slds-grid--align-spread slds-m-bottom--small fs-edit-section-header"
                                                     style="background-color: #f3f2f2 !important;">
                                                    <div class="slds-col slds-align-middle">
                                                        <h3><span style="color: #16325c;">
                                                                <strong>Itemizations</strong>
                                                            </span>
                                                        </h3>
                                                    </div>
                                                    
                                                    <div class="slds-col slds-no-flex slds-align-middle">
                                                        <apex:commandLink action="{!onAddItemization}" 
                                                                          value="{!$Label.fscore__add_button}"
                                                                          title="{!$Label.fscore__add_button}"
                                                                          reRender="messagePanel,iItemizationContentPanel" 
                                                                          status="waitActionStatus"
                                                                          style="padding: 4px 8px !important;"
                                                                          styleClass="fs-small-button--brand"/>&nbsp;&nbsp;
    
                                                        <apex:commandLink action="{!onCalculateItemizations}" 
                                                                          value="{!$Label.fscore__calculate_button}"
                                                                          title="{!$Label.Calculate_All_Itemization_Button_Toolip}"
                                                                          reRender="messagePanel,iContractParamDetailPanel,iItemizationContentPanel" 
                                                                          status="waitActionStatus"
                                                                          style="padding: 4px 8px !important;"
                                                                          styleClass="fs-small-button--brand"/>&nbsp;&nbsp;
    
                                                        <apex:commandLink action="{!onSyncItemizationsToContract}" 
                                                                          value="{!$Label.fscore__calculate_and_sync_button}"
                                                                          title="{!$Label.fscore__calculate_and_sync_itemization_tooltip}"
                                                                          reRender="messagePanel,iContractParamDetailPanel,iItemizationContentPanel" 
                                                                          status="waitActionStatus"
                                                                          style="padding: 4px 8px !important;"
                                                                          styleClass="fs-small-button--brand"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- / Section title -->
                                            <c:lendingAppItemizationEditList itemizationObjectList="{!mItemizationObjectList}" 
                                                                             requestMode="false"/>
                                        </apex:outputPanel>

                                        <apex:outputPanel id="iContractualFeePanel">
                                            <div class="slds-m-top_small">                                 
                                                <c:lendingAppFeeEditList contractualFeeObjectList="{!mContractualFeeObjectList}"/>
                                            </div>
                                        </apex:outputPanel>

                                    </div>
                                    <!-- / Apply Template -->
                                    
                                    
                                    <!-- Calculate Repayment -->
                                    <div id="calcRepaymentTabContent" class="slds-tabs--scoped__content slds-hide"
                                         role="tabpanel" aria-labelledby="calcRepaymentTabLabel">

                                        <!-- Contract Params -->
                                        <apex:outputPanel id="iContractParamDetailPanel">
                                            <div class="slds-grid slds-grid--align-spread slds-m-bottom--small">
                                                <div class="slds-col"></div>
                                                <div class="slds-col slds-no-flex slds-align-top">
                                                    <apex:commandButton id="calculateButtonTop" action="{!onCalculate}" 
                                                                        value="{!$Label.fscore__calculate_button}"
                                                                        title="{!$Label.fscore__calculate_button}"
                                                                        reRender="messagePanel,iContractParamDetailPanel,iCalcResultPanel" 
                                                                        status="waitActionStatus"
                                                                        styleClass="slds-button slds-button--brand"
                                                                        oncomplete="onCalculationComplete();"/>
                                                </div>
                                            </div>
                
                                            <apex:pageBlockSection id="iFinancialParamSection" columns="2" collapsible="false">
                                                <!-- Financed Amount -->
                                                <apex:pageBlockSectionItem id="iFinancedAmount">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Financed_Amount__c.Label}">
                                                        <apex:outputPanel id="iFinancedAmountRequired" 
                                                                          rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"
                                                                          styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:outputPanel >
                                                        <apex:outputField id="iFinancedAmountReadOnly"
                                                                          value="{!mApplication.Financed_Amount__c}"
                                                                          rendered="{!NOT($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
                                                        <apex:inputField id="iFinancedAmountValue"
                                                                         value="{!mApplication.Financed_Amount__c}"
                                                                         rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
                                                    </apex:outputPanel>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Rate -->
                                                <apex:pageBlockSectionItem id="iRate">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Rate__c.Label}">
                                                        <apex:outputPanel id="iRateRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:inputField id="iRateValue" value="{!mApplication.Rate__c}"/>
                                                </apex:pageBlockSectionItem>
                
                                               <!-- Prepaid Fee -->
                                                <apex:pageBlockSectionItem id="iPrepaidFee">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Prepaid_Fee__c.Label}">
                                                        <apex:outputPanel rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"
                                                                          styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:outputPanel >
                                                        <apex:outputField id="iPrepaidFeeReadOnly" value="{!mApplication.Prepaid_Fee__c}"
                                                                          rendered="{!NOT($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
                                                        <apex:inputField id="iPrepaidFeeValue" value="{!mApplication.Prepaid_Fee__c}"
                                                                         rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
                                                    </apex:outputPanel>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Term -->
                                                <apex:pageBlockSectionItem id="iTerm">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Term__c.Label}">
                                                        <apex:outputPanel id="iTermRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:inputField id="iTermValue" value="{!mApplication.Term__c}"/>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Financed Fee -->
                                                <apex:pageBlockSectionItem id="iFinancedFee">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Finance_Fee__c.Label}">
                                                        <apex:outputPanel rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"
                                                                          styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:outputPanel >
                                                        <apex:outputField id="iFinanceFeeReadOnly" value="{!mApplication.Finance_Fee__c}" 
                                                                          rendered="{!NOT($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
                                                        <apex:inputField id="iFinanceFeeValue" value="{!mApplication.Finance_Fee__c}"
                                                                         rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
                                                    </apex:outputPanel>
                                                </apex:pageBlockSectionItem>
            
                                                <!-- Payment Frequency-->
                                                <apex:pageBlockSectionItem id="iPaymentFrequency">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Payment_Frequency__c.Label}">
                                                        <apex:outputPanel id="iPaymentFrequencyRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:inputField id="iPaymentFrequencyValue" value="{!mApplication.Payment_Frequency__c}"/>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Contract Date -->
                                                <apex:pageBlockSectionItem id="iContractDate">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Contract_Date__c.Label}">
                                                        <apex:outputPanel id="iContractDateRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:inputField id="iContractDateValue" value="{!mApplication.Contract_Date__c}"/>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Payment Start Date -->
                                                <apex:pageBlockSectionItem id="iPaymentStartDate">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Payment_Start_Date__c.Label}">
                                                        <apex:outputPanel id="iPaymentStartDateRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:inputField id="iPaymentStartDateValue" value="{!mApplication.Payment_Start_Date__c}"/>
                                                </apex:pageBlockSectionItem>
            
                                                <!-- Payment Amount-->
                                                <apex:pageBlockSectionItem id="iPaymentAmount">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Payment_Amount__c.Label}">
                                                        <apex:outputPanel id="iPaymentAmountRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                                    </apex:outputLabel>
                                                
                                                    <apex:inputField id="iPaymentAmountValue" value="{!mApplication.Payment_Amount__c}"/>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Balloon Amount-->
                                                <apex:pageBlockSectionItem id="iBalloonAmount">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Balloon_Amount__c.Label}"></apex:outputLabel>
                                                
                                                    <apex:inputField id="iBalloonAmountValue"
                                                                     value="{!mApplication.Balloon_Amount__c}"/>
                                                </apex:pageBlockSectionItem>
            
                                                <!-- Interest Only Term -->
                                                <apex:pageBlockSectionItem id="iInterestOnlyTerm">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Interest_Only_Term__c.Label}"></apex:outputLabel>
                                                
                                                    <apex:inputField id="iInterestOnlyValue" value="{!mApplication.Interest_Only_Term__c}"/>
                                                </apex:pageBlockSectionItem>
                
                                                <!-- Interest Start Date -->
                                                <apex:pageBlockSectionItem id="iInterestStartDate">
                                                    <apex:outputLabel value="{!$ObjectType.Lending_Application__c.Fields.Interest_Accrual_Start_Date__c.Label}"></apex:outputLabel>
                                                
                                                    <apex:inputField id="iInterestStartDateValue" value="{!mApplication.Interest_Accrual_Start_Date__c}"/>
                                                </apex:pageBlockSectionItem>
                        
                                                <!-- show additional fields from field set -->
                                                <apex:repeat value="{!$ObjectType.Lending_Application__c.FieldSets.Contract_Additional_Edit_Fields}" var="additionalInfo">
                                                    <apex:pageBlockSectionItem >
                                                        <apex:outputLabel value="{!additionalInfo.Label}">
                                                            <apex:outputPanel styleClass="fs-required slds-m-left--xxx-small" 
                                                                              rendered="{!OR(additionalInfo.required, additionalInfo.dbRequired)}">*</apex:outputPanel>
                                                        </apex:outputLabel>
                                                        <apex:inputField value="{!mApplication[additionalInfo.fieldPath]}" required="false"/>
                                                    </apex:pageBlockSectionItem>
                                               </apex:repeat>
                                            </apex:pageBlockSection>
                                                
                                        </apex:outputPanel>
                                        
                                        <!-- Advance Preferences -->
                                        <div class="slds-grid slds-grid--align-spread slds-container--fluid slds-m-top_small">
                                            <div class="slds-col slds-size--1-of-1 slds-large-size--1-of-2 slds-p-right--small slds-col--rule-right">
                                                <apex:outputPanel id="iPredefinedPmtPanel">                                    
                                                    <c:lendingAppPredefinedPayment applicationId="{!mApplication.Id}"
                                                                                   predefinedPaymentList="{!mPredefinedPmtObjectList}"
                                                                                   removedPredefinedPaymentList="{!mRemovedPredefinedPmtList}"
                                                                                   isApplicable="{!mApplication.Is_Predefined_User_Payments_Allowed__c}"
                                                                                   titleStyleClass="slds-text-body--regular"/>
                                                </apex:outputPanel>
                                            </div>
                                            <div class="slds-col slds-size--1-of-1 slds-large-size--1-of-2 slds-p-left--small">
                                                <apex:outputPanel id="iRatePreferencePanel">
                                                    <c:lendingAppRatePreference applicationId="{!mApplication.Id}"
                                                                                ratePreferenceList="{!mRatePrefObjectList}"
                                                                                removedRatePreferenceList="{!mRemovedRatePrefList}"
                                                                                isApplicable="{!mApplication.Is_Advance_Rate_Preferences_Allowed__c}"
                                                                                titleStyleClass="slds-text-body--regular"/>
                                                </apex:outputPanel>
                                            </div>
                                        </div>

                                        <div class="slds-m-top--large">
                                            <apex:outputPanel id="iPmtPreferencePanel">
                                                <c:lendingAppPaymentPreference applicationId="{!mApplication.Id}"
                                                                               paymentPreferenceList="{!mPaymentPrefObjectList}"
                                                                               removedPaymentPreferenceList="{!mRemovedPaymentPrefList }"
                                                                               isApplicable="{!mApplication.Is_Advance_Payment_Preferences_Allowed__c}"
                                                                               titleStyleClass="slds-text-body--regular"/>
                                            </apex:outputPanel>
                                        </div>

                                        <!-- Commented by SSingh : To be implemented with Promotion feature -->
                                        <!--
                                            <div class="slds-m-top--medium">
                                                <c:lendingAppHolidayPreference applicationId="{!mApplication.Id}"
                                                                               holidayPreferenceList="{!mHolidayPrefObjectList}"
                                                                               removedHolidayPreferenceList="{!mRemovedHolidayPrefList}"
                                                                               titleStyleClass="slds-text-body--regular"/>
                                            </div>
                                        -->
                                        
                                        <div class="slds-grid slds-grid--align-spread slds-m-top--small">
                                            <div class="slds-col"></div>
                                            <div class="slds-col slds-no-flex slds-align-top">
                                                <apex:commandButton id="calculateButtonBottom" action="{!onCalculate}" 
                                                                    value="{!$Label.fscore__calculate_button}"
                                                                    title="{!$Label.fscore__calculate_button}"
                                                                    reRender="messagePanel,iContractParamDetailPanel,iCalcResultPanel" 
                                                                    status="waitActionStatus"
                                                                    styleClass="slds-button slds-button--brand"
                                                                    oncomplete="onCalculationComplete();"/>
                                            </div>
                                        </div>
            
                                        <!-- Calculation Result -->
                                        <apex:outputPanel id="iCalcResultPanel">                                    
                                            <div class="slds-m-top_small">
                                            <apex:pageBlockSection id="iCalcResultSection" columns="2" collapsible="false">
                                                <!-- show calculated fields from field set -->
                                                <apex:repeat value="{!$ObjectType.Lending_Application__c.FieldSets.Contract_Calculated_Fields}" var="calculatedField">
                                                    <apex:pageBlockSectionItem >
                                                        <apex:outputLabel value="{!calculatedField.Label}"></apex:outputLabel>
                                                        <apex:outputField value="{!mApplication[calculatedField.fieldPath]}"/>
                                                    </apex:pageBlockSectionItem>
                                                </apex:repeat>
                                            </apex:pageBlockSection>
                                            </div>
                                        </apex:outputPanel>                                        
                                    </div>
                                    
                                    <!-- Repayment Details -->
                                    <div id="repayDetailTabContent" class="slds-tabs--scoped__content slds-hide"
                                         role="tabpanel" aria-labelledby="repayDetailTabLabel">
        
                                            <c:sectionHeader label="{!$Label.fscore__repayment_schedule_section_title}"
                                                             isEditSectionHeader="true" isModalWindow="true"/>

                                            <div class="slds-m-horizontal--small">
                                                <apex:dataTable id="iRepaySchTable" value="{!mRepayScheduleList}" var="repaySch"
                                                                rendered="{!(mRepayScheduleList.size > 0)}"
                                                                styleClass="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">  
                                                    
                                                    <apex:repeat value="{!$ObjectType.Lending_Application_Repayment_Schedule__c.FieldSets.Repayment_Schedule_List_View_Fields}" var="listViewField">
                                                        <apex:column >
                                                            <apex:facet name="header">
                                                                <span class="slds-text-heading--x-small slds-truncate">
                                                                    <strong>{!listViewField.Label}</strong>
                                                                </span>
                                                            </apex:facet>
                                                            <apex:outputField value="{!repaySch[listViewField.fieldPath]}" styleClass="slds-truncate"/>
                                                        </apex:column>
                                                    </apex:repeat>
                                                    
                                                </apex:dataTable>
                                                
                                                <apex:outputPanel rendered="{!(mRepayScheduleList.size == 0)}">
                                                    <div class="slds-align--absolute-center">
                                                        <span class="slds-text-body--regular">{!$Label.fscore__no_record_to_display}</span>
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                    </div>
                                </div>
                                <!-- / Additional Details -->
        
                            </apex:pageBlock>
                        </apex:outputPanel>
                    </div>
                </div>
            </apex:form>
            <!-- / Wizard Step Body -->

            <!-- Footer -->
            <c:fsCopyright pageTitle="{!mPageTitle} - {!mPageSubTitle}"/>
            <!-- / Footer -->
        </div>
        
        <script src="{!URLFOR($Resource.fs_slds_tabs_js, 'fs_slds_tabs_js.js')}"/>
        <c:fsModalWindow />
            
        <script>
            $j(document).ready( function() {
                setFieldDisplayProperties();
            });
            
            function onCalculationComplete(){
                setFieldDisplayProperties();
                navigateToResult();
            }
            
            function setFieldDisplayProperties(){
                var selectedCalcParam = $j("select[id$=iSelectedCalcParam").find(":selected").val();
                
                $j("input[id$=iFinancedAmountValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iRateValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iTermValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iPaymentAmountValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iBalloonAmountValue]").prop("style", "background-color: #ffffff !important;");
    
                $j("span[id$=iFinancedAmountRequired]").prop("style", "display: inline;");
                $j("span[id$=iRateRequired]").prop("style", "display: inline;");
                $j("span[id$=iTermRequired]").prop("style", "display: inline;");
                $j("span[id$=iPaymentAmountRequired]").prop("style", "display: inline;");
            
                if (selectedCalcParam === 'FinancedAmount'){
                    $j("input[id$=iFinancedAmountValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iFinancedAmountRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Rate'){
                    $j("input[id$=iRateValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iRateRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Term'){
                    $j("input[id$=iTermValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iTermRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Payment'){
                    $j("input[id$=iPaymentAmountValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iPaymentAmountRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Balloon'){
                    $j("input[id$=iBalloonAmountValue]").prop("style", "background-color: #eaecef !important;");
                }
            }
            
            function navigateToResult(){
                $j("li[id$=calculationResultTab]").click();
            }

        </script>
    </body>
</apex:page>
