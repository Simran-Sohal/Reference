<apex:page id="bankAccountEditPage" standardController="Bank_Account__c"
           extensions="BankAccountEditController" tabStyle="Bank_Account__c"
           showHeader="{!NOT(mIsModalWindow)}" sidebar="{!NOT(mIsModalWindow)}"
           title="{!$Label.fscore__edit_bank_account_title}" applyHtmlTag="true" docType="html-5.0" >

    <head>
        <apex:slds />
        <apex:stylesheet value="{!URLFOR($Resource.fs_style, 'fs-style.css')}"/>
        <script src="{!URLFOR($Resource.fs_svg, 'svg4everybody.js')}"></script>
        <meta http-equiv="x-ua-compatible" content="ie=edge"/>
        <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" />
        <script src="{!URLFOR($Resource.fs_svg, 'svg4everybody.js')}"></script>
        <script>
            svg4everybody();
            var $j = jQuery.noConflict();
        </script>
    </head>   

    <body>   
        <div class="slds-scope">
            <apex:form id="bankAccountEditForm" styleClass="{!IF(mIsModalWindow,'slds-p-horizontal--xx-small','')} slds-form--horizontal fs-data-form slds-m-bottom--large">

                <div id="modal-sticky-anchor"></div>
                <div id="modal-sticky-header">
                   <!-- When this page is opened as modal window, the JS function 
                      -- reloadBankAccountDetails referred in oncomplete of Save button
                      -- must be defined in the parent page to handle the save action 
                      -- complete event
                      --> 
                    <div class="slds-page-header slds-m-bottom--small" role="banner">
                        <div class="slds-grid slds-grid--align-spread">
                            <div class="slds-col" align="left">
                                <div class="slds-media">
                                    <div class="slds-media__figure">
                                       <c:svgIcon iconStyleClass="slds-icon {!IF(mIsModalWindow,'slds-icon--medium','slds-icon--large')} slds-icon-standard-case"
                                                  iconPath="{!URLFOR($Asset.SLDS, 'assets/icons/custom-sprite/svg/symbols.svg#custom16')}"/>
                                    </div>
                                    <div class="slds-media__body slds-align-middle">
                                        <p class="slds-text-heading--label">{!$ObjectType.Bank_Account__c.Label}</p>
                                        <h1 class="slds-page-header__title slds-m-right--small slds-truncate slds-align-middle">
                                            {!IF(ISBLANK(mBankAccount.Id), $Label.fscore__new_bank_account_title, mBankAccount.Name)}
                                        </h1>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="slds-col slds-no-flex slds-align-middle">
                                <apex:commandButton value="{!$Label.fscore__save_button}" 
                                                    title="{!$Label.fscore__save_button_tooltip}"
                                                    styleClass="slds-button slds-button--brand"
                                                    action="{!onSave}" 
                                                    status="saveRecordStatus"
                                                    reRender="messagePanel,bankAccountBlockPanel"
                                                    oncomplete="closeModalFromModalWindow('save',{!mIsError},{!mIsModalWindow},'reloadBankAccountDetails');"/>
                                                    
                                <apex:commandButton immediate="true" action="{!cancel}"
                                                    value="{!$Label.fscore__cancel_button}" 
                                                    title="{!$Label.fscore__cancel_button_tooltip}"
                                                    styleClass="slds-button slds-button--neutral"
                                                    onclick="closeModalFromModalWindow('cancel',false,{!mIsModalWindow},'');"/>
                            </div>
                        </div>
                    </div>

                </div>

                <apex:actionStatus id="saveRecordStatus">
                    <apex:facet name="start">
                        <c:fsSpinner spinnerSize="medium"/>
                    </apex:facet>
                </apex:actionStatus>

                <apex:outputPanel id="messagePanel" styleClass="fs-message-panel">
                    <apex:pagemessages />
                </apex:outputPanel>          

                <div class="slds-m-top_small">
                    <div class="{!IF(mIsModalWindow,'', 'slds-box slds-box_x-small')} slds-container_fluid">
                        <apex:outputPanel id="bankAccountBlockPanel">
                            <apex:pageBlock id="bankAccountPageBlock" mode="mainDetail" html-class="fs-data-block">
                                
                                <apex:outputPanel id="bankAccountInfoPanel">
                                    <c:sectionHeader label="{!$Label.fscore__information_block_title}"
                                                     isEditSectionHeader="true" isModalWindow="true"/>

                                    <div id="bankAccountInfoSection" class="slds-grid slds-wrap slds-m-horizontal_small">
                                        <!-- Account Field -->
                                        <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
                                                <span class="slds-truncate">{!$ObjectType.Bank_Account__c.Fields.Account_Name__c.Label}</span>
                                            </p>
                                            <apex:outputPanel id="iAccountPanel">
                                                <apex:actionRegion >
                                                <apex:inputField value="{!mBankAccount.Account_Name__c}">
                                                    <apex:actionSupport event="onchange" action="{!onAccountChange}" 
                                                                        reRender="iAccountPanel,iContactPanel" status="accountChangeStatus"/>
                                                </apex:inputField>&nbsp;
        
                                                <apex:actionStatus id="accountChangeStatus">
                                                    <apex:facet name="start">
                                                        <apex:image style="height:24px;" 
                                                                    url="{!URLFOR($Resource.fs_slds,'/assets/images/spinners/slds_spinner_brand.gif')}" />
                                                    </apex:facet>
                                                </apex:actionStatus>
                                                </apex:actionRegion>
                                            </apex:outputPanel>
                                        </div>
             
                                        <!-- Contact Field -->
                                        <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
                                                <span class="slds-truncate">{!$ObjectType.Bank_Account__c.Fields.Contact_Name__c.Label}</span>
                                            </p>
                                            <apex:outputPanel id="iContactPanel">
                                                <!-- Lookup Field -->
                                                <apex:inputField value="{!mBankAccount.Contact_Name__c}"
                                                                 rendered="{!ISBLANK(mBankAccount.Account_Name__c)}">
                                                </apex:inputField>
                                                <!-- / Lookup Field -->
                                                                            
                                                <!-- List Field -->
                                                <apex:selectList value="{!mBankAccount.Contact_Name__c}" 
                                                                 multiselect="false" size="1"
                                                                 rendered="{!NOT(ISBLANK(mBankAccount.Account_Name__c))}">
                                                    <apex:selectOptions value="{!mContactList}"/>
                                                </apex:selectList>
                                                <!-- / List Field -->
                                                                            
                                            </apex:outputPanel>
                                        </div>
                                 
                                        <apex:repeat value="{!$ObjectType.Bank_Account__c.FieldSets.Bank_Account_Edit_Fields}" var="editInfo">
                                            <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
                                                <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
                                                    <span class="slds-truncate">{!editInfo.Label}</span>
                                                    <apex:outputPanel rendered="{!OR(editInfo.required, editInfo.dbrequired)}"
                                                                      styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
                                                </p>
                                                <apex:inputField value="{!mBankAccount[editInfo.fieldPath]}" required="false"/>
                                            </div>
                                        </apex:repeat>
                                    </div>
                                </apex:outputPanel>                            

                                <apex:outputPanel id="additionalInfoPanel" rendered="{!($ObjectType.Bank_Account__c.FieldSets.Additional_Info_Fields.size > 0)}">
                                    <div class="slds-m-top_small">
                                        <c:sectionHeader label="{!$Label.fscore__additional_information_block_title}"
                                                         isEditSectionHeader="true" isModalWindow="true"/>
                                    </div>
                                    
                                    <div id="additionalInfoSection" class="slds-grid slds-wrap slds-m-horizontal_small">
                                        <apex:repeat value="{!$ObjectType.Bank_Account__c.FieldSets.Additional_Info_Fields}" var="addlInfo">
                                            <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
                                                <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
                                                    <span class="slds-truncate">{!addlInfo.Label}</span>
                                                    <apex:outputPanel rendered="{!OR(addlInfo.required, addlInfo.dbrequired)}"
                                                                      styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
                                                </p>
                                                <apex:inputField value="{!mBankAccount[addlInfo.fieldPath]}" required="false"/>
                                            </div>
                                        </apex:repeat>
                                    </div>
                                </apex:outputPanel>                            

                            </apex:pageBlock>
                        </apex:outputPanel>
                    </div>
                </div>
            </apex:form>
            <div class="{!IF(mIsModalWindow,'slds-hide','')}">
                <c:fsCopyright pageTitle="{!IF(ISBLANK(mBankAccount.Id), $Label.fscore__new_bank_account_title, mBankAccount.Name)}"/>
            </div>
        </div>

        <script src="{!$Resource.fs_modal_window_close_js}"/>
        <script src="{!URLFOR($Resource.fs_modal_sticky_header, 'fs_modal_sticky_header.js')}"/>
    </body>
</apex:page>
