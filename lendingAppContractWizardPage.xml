<apex:page id="lendingAppContractWizardPage" standardController="Lending_Application__c" 
           extensions="LendingAppContractWizardController" tabStyle="Lending_Application__c"
           standardStylesheets="true" showHeader="{!NOT(mWizardLayout.mIsFullScreenMode)}"
           sidebar="{!NOT(mWizardLayout.mIsFullScreenMode)}" 
           title="{!mPageTitle} : {!mPageSubTitle}">  

    <head>
        <meta http-equiv="x-ua-compatible" content="ie=edge"/>
        <apex:slds />
        <apex:stylesheet value="{!URLFOR($Resource.fs_style, 'fs-style.css')}"/>
        <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" />
        <script src="{!URLFOR($Resource.fs_svg, 'svg4everybody.js')}"/>
        <script>var $j = jQuery.noConflict();</script>
    </head>
    
    <body>
        <div class="slds-scope">
            <apex:form styleClass="fs-data-form slds-form--stacked slds-m-horizontal_x-small" rendered="{!$ObjectType.Lending_Application__c.accessible}">

                <c:wizardPageHeader parentRecordId="{!mApplication.Id}"
                                    iconStyleClass="slds-icon slds-icon--large slds-icon-standard-apps"
                                    iconPath="{!URLFOR($Asset.SLDS, 'assets/icons/custom-sprite/svg/symbols.svg#custom18')}"
                                    pageTitle="{!mPageTitle}"
                                    pageSubTitle="{!mPageSubTitle}"
                                    recordTitle="{!mApplication.Title__c}"
                                    recordTitleBadge="{!$Label.fscore__title_badge}"
                                    previousAction="{!onPrevious}"
                                    renderPrevious="{!hasPrevious}"
                                    nextAction="{!onNext}"
                                    renderNext="{!hasNext}"
                                    saveAction="{!onSave}"
                                    renderSave="true"
                                    saveAndReturnAction="{!onSaveAndReturn}"
                                    cancelAction="{!onCancel}"
                                    wizardSectionList="{!mWizardSectionList}"
                                    directNavigationWarning="{!mWizardLayout.mShowDirectNavigationWarning}"/>

                <apex:outputPanel id="messagePanel" styleClass="fs-message-panel">
                    <apex:pageMessages ></apex:pageMessages>
                </apex:outputPanel>
    
                <apex:actionStatus id="waitActionStatus">
                    <apex:facet name="start">
                        <c:fsSpinner spinnerSize="medium"/>
                    </apex:facet>
                </apex:actionStatus>
        
                <div class="slds-container_fluid slds-m-vertical_small">
                    <c:pageMessage messageTitle="{!$Label.fscore__invalid_access}" 
                                   messageDetail="{!$Label.fscore__contract_info_invalid_access_message}" 
                                   rendered="{!ISBLANK(mApplication.Id)}"
                                   backgroundTheme="default"
                                   iconTheme="slds-icon-text-error"
                                   iconType="assets/icons/utility-sprite/svg/symbols.svg#error"/>
        
                    <apex:outputPanel id="iEditContractInfoPanel" rendered="{!NOT(ISBLANK(mApplication.Id))}">
                        <apex:pageBlock id="iContractInfoBlock" mode="maindetail" html-class="fs-data-block">

                            <div id="iContractInfoTabPanel" class="slds-tabs_scoped">
                                <ul class="slds-tabs_scoped__nav" role="tablist">
                                    <!-- Tab 1 Title -->
                                    <li class="slds-tabs_scoped__item slds-text-heading_label slds-active" role="presentation">
                                        <a id="tab_1_Title" class="slds-tabs_scoped__link" href="#void" role="tab" 
                                           tabindex="0" aria-selected="true" aria-controls="tab_1_Content" >
                                            {!$Label.Contract_Template_Tab_Title}
                                        </a>
                                    </li>
                                    <!-- / Tab 1 Title -->
    
                                    <!-- Tab 2 Title -->
                                    <li class="slds-tabs_scoped__item slds-text-heading_label"
                                        role="presentation">
                                        <a id="tab_2_Title" class="slds-tabs_scoped__link" href="#void" role="tab" 
                                           tabindex="-1" aria-selected="false" aria-controls="tab_2_Content" >
                                            {!$Label.Contract_Tab_Title}
                                        </a>
                                    </li>
                                    <!-- / Tab 2 Title -->

                                    <!-- Tab 3 Title -->
                                    <li class="slds-tabs_scoped__item slds-text-heading_label"
                                        role="presentation">
                                        <a id="tab_3_Title" class="slds-tabs_scoped__link" href="#void" role="tab" 
                                           tabindex="-1" aria-selected="false" aria-controls="tab_3_Content" >
                                            {!$Label.Repayment_Tab_Title}
                                        </a>
                                    </li>
                                    <!-- / Tab 3 Title -->
                                </ul>
    
                                <!-- Tab 1 Contents -->
                                <div id="tab_1_Content" class="slds-tabs_scoped__content slds-show"
                                     role="tabpanel" aria-labelledby="tab_1_Title">

                                    <c:sectionHeader label="{!$Label.fscore__contract_template_info_section}" 
                                                     isEditSectionHeader="true" isModalWindow="true"/>

                                    <div class="slds-grid slds-wrap slds-m-horizontal_small">
                                        <!-- Contract Template -->
                                        <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-truncate">
                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Contract_Template_Name__c.Label}</span>
                                                <apex:outputPanel styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
                                            </p>
                                            <apex:outputPanel id="iContractTemplateListPanel">
                                                <c:actionSelectList value="{!mApplication.Contract_Template_Name__c}"
                                                                    selectOptions="{!mContractTemplateSelectList}"
                                                                    changeAction="{!onContractTemplateChange}"
                                                                    enableChangeAction="true"
                                                                    refreshAction="{!onContractTemplateListRefresh}"
                                                                    enableRefreshAction="true"
                                                                    style="width: auto !important;"
                                                                    reRender="messagePanel,iContractTemplateListPanel"/>
                                                &nbsp;
                                                <apex:commandLink rendered="{!NOT(ISBLANK(mApplication.Contract_Template_Name__c))}"
                                                                  type="image/png"
                                                                  title="{!$Label.fscore__view_contract_template_details_tooltip}"
                                                                  reRender="iContractTemplateListPanel"
                                                                  style="align-self: center;"
                                                                  onclick="OpenModalView('/apex/fscore__contractTemplateViewPage?Id={!mApplication.Contract_Template_Name__c}');">
                                                    <apex:image value="{!URLFOR($Resource.fs_slds, 'assets/icons/utility/open_60.png')}"
                                                                styleClass="fs-action-icon" />
                                                </apex:commandLink>
                                                &nbsp;
                                                <apex:commandButton id="applyContractTemplate" action="{!onContractTemplateApply}"
                                                                    value="{!$Label.fscore__apply_button}"
                                                                    title="{!$Label.fscore__apply_contract_template_message}"
                                                                    styleClass="slds-button slds-button--brand fs-small-button--brand"
                                                                    status="waitActionStatus"
                                                                    oncomplete="setFieldDisplayProperties();"
                                                                    reRender="messagePanel,iContractTemplateListPanel,iContractParamDetailPanel,iItemizationContentPanel,iContractualFeePanel,iPredefinedPmtPanel,iRatePreferencePanel,iPmtPreferencePanel"
                                                                    rendered="{!NOT(ISBLANK(mApplication.Contract_Template_Name__c))}"/>
                                            </apex:outputPanel>
                                        </div>
                                        <!-- / Contract Template -->
                                    </div>
                                    
                                    <apex:outputPanel id="iItemizationContentPanel">
	                                    <div class="slds-m-top_small">
	                                        <div class="slds-grid slds-grid_align-spread slds-m-bottom_small fs-edit-section-header"
	                                             style="background-color: #f3f2f2 !important;">
	                                            <div class="slds-col slds-align-middle">
	                                                <h3><span style="color: #16325c;">
	                                                        <strong>{!$Label.Itemization_Section_Title}</strong>
	                                                    </span>
	                                                </h3>
	                                            </div>
	                                            
	                                            <div class="slds-col slds-no-flex slds-align-middle">
	                                                <apex:commandLink action="{!onCalculateItemizations}" 
	                                                                  value="{!$Label.fscore__calculate_button}"
	                                                                  title="{!$Label.fscore__calculate_all_itemization_button_toolip}"
	                                                                  reRender="messagePanel,iContractParamDetailPanel,iItemizationContentPanel" 
	                                                                  status="waitActionStatus"
	                                                                  style="padding: 4px 8px !important;"
	                                                                  styleClass="fs-small-button--brand"/>&nbsp;
	
	                                                <apex:commandLink action="{!onSyncItemizationsToContract}" 
	                                                                  value="{!$Label.fscore__calculate_and_sync_button}"
	                                                                  title="{!$Label.fscore__calculate_and_sync_itemization_tooltip}"
	                                                                  reRender="messagePanel,iContractParamDetailPanel,iItemizationContentPanel" 
	                                                                  status="waitActionStatus"
	                                                                  style="padding: 4px 8px !important;"
	                                                                  styleClass="fs-small-button--brand"/>&nbsp;
							    
	                                                <apex:commandLink action="{!onAddItemization}"
                                                                          rendered="{!$ObjectType.Lending_Application_Itemization__c.createable}"
                                                                          reRender="messagePanel,iItemizationContentPanel" 
                                                                          title="{!$Label.fscore__add_button_tooltip}"
                                                                          status="waitActionStatus"
                                                                          style="color: #ffffff !important;align-self: center;" 
                                                                          type="image/png">
                                                           <apex:image value="{!URLFOR($Resource.fs_slds, 'assets/icons/action/new_60.png')}"
                                                                       styleClass="fs-small-button--brand" height="24px" width="24px" 
                                                                       style="padding: 2px !important;" />
                                                       </apex:commandLink>
						    </div>
	                                        </div>

                                            <c:lendingAppItemizationEditList itemizationObjectList="{!mItemizationObjectList}" 
                                                                             requestMode="false"/>
                                        </div>
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel id="iContractualFeePanel">
                                        <div class="slds-m-top_small">
 		                                    <c:sectionHeader label="{!$Label.Contract_Fee_Section_Title}" 
		                                                     isEditSectionHeader="true" isModalWindow="true"/>
		 
                                            <c:lendingAppFeeEditList contractualFeeObjectList="{!mContractualFeeObjectList}"
                                                                     titleStyleClass="slds-hide"/>
                                        </div>                              
                                    </apex:outputPanel>
                                </div>
                                <!-- / Tab 1 Contents -->
                                
                                <!-- Tab 2 Contents -->
                                <div id="tab_2_Content" class="slds-tabs_scoped__content slds-hide"
                                     role="tabpanel" aria-labelledby="tab_2_Title">

	                                <!-- Contract Params -->
	                                <apex:outputPanel id="iContractParamDetailPanel">
	                                    <div class="slds-grid slds-grid_align-spread slds-m-bottom_small">
	                                        <div class="slds-col"></div>
	                                        <div class="slds-col slds-no-flex slds-align-top">
	                                            <apex:selectList id="iSelectedCalcParam" multiselect="false" size="1"
	                                                             title="{!$Label.fscore__calculate_option_tooltip}"
	                                                             value="{!mCalculateOption}"
	                                                             style="height: 1.5rem !important; width: 100% !important;"
	                                                             styleClass="slds-m-horizontal--xx-small"
	                                                             onchange="setFieldDisplayProperties();">
	                                                 <apex:selectOptions value="{!mCalculateOptionList}"/>
	                                            </apex:selectList>&nbsp;
	                                            
	                                            <apex:commandButton id="calculateButtonTop" action="{!onCalculate}" 
	                                                                value="{!$Label.fscore__calculate_button}"
	                                                                title="{!$Label.fscore__calculate_button}"
	                                                                reRender="messagePanel,iContractParamDetailPanel,iCalcResultPanel" 
	                                                                status="waitActionStatus"
	                                                                styleClass="slds-button slds-button--brand"
	                                                                oncomplete="onCalculationComplete();"/>
	                                        </div>
	                                    </div>
	        
	                                    <div class="slds-grid slds-wrap slds-m-horizontal_small">
	                                        <!-- Financed Amount -->
	                                        <div id="iFinancedAmount" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Financed_Amount__c.Label}</span>
	                                                <apex:outputPanel id="iFinancedAmountRequired" 
	                                                                  rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"
	                                                                  styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:outputField id="iFinancedAmountReadOnly" value="{!mApplication.Financed_Amount__c}"
	                                                              rendered="{!NOT($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
	                                            <apex:inputField id="iFinancedAmountValue" value="{!mApplication.Financed_Amount__c}"
	                                                             rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
	                                        </div>
	
	                                        <!-- Rate -->
	                                        <div id="iRate" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Rate__c.Label}</span>
	                                                <apex:outputPanel id="iRateRequired" styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:inputField id="iRateValue" value="{!mApplication.Rate__c}"/>
	                                        </div>
	
	                                        <!-- Term -->
	                                        <div id="iTerm" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Term__c.Label}</span>
	                                                <apex:outputPanel id="iTermRequired" styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:inputField id="iTermValue" value="{!mApplication.Term__c}"/>
	                                        </div>
	                                        
	                                        <!-- Frequency -->
	                                        <div id="iPaymentFrequency" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Payment_Frequency__c.Label}</span>
	                                                <apex:outputPanel id="iPaymentFrequencyRequired" styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:inputField id="iPaymentFrequencyValue" value="{!mApplication.Payment_Frequency__c}"/>
	                                        </div>
	
	                                        <!-- Contract Date -->
	                                        <div id="iContractDate" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Contract_Date__c.Label}</span>
	                                                <apex:outputPanel id="iContractDateRequired" styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:inputField id="iContractDateValue" value="{!mApplication.Contract_Date__c}"/>
	                                        </div>
	        
	                                        <!-- Payment Start Date -->
	                                        <div id="iPaymentStartDate" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Payment_Start_Date__c.Label}</span>
	                                                <apex:outputPanel id="iPaymentStartDateRequired" styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:inputField id="iPaymentStartDateValue" value="{!mApplication.Payment_Start_Date__c}"/>
	                                        </div>
	
	                                        <!-- Payment Amount-->
	                                        <div id="iPaymentAmount" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Payment_Amount__c.Label}</span>
	                                                <apex:outputPanel id="iPaymentAmountRequired" styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                             <apex:inputField id="iPaymentAmountValue" value="{!mApplication.Payment_Amount__c}"/>
	                                        </div>
	
	                                        <!-- Prepaid_Fee__c -->
	                                        <div id="iPrepaidFee" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Prepaid_Fee__c.Label}</span>
	                                                <apex:outputPanel rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"
	                                                                  styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:outputField id="iPrepaidFeeReadOnly" value="{!mApplication.Prepaid_Fee__c}"
	                                                              rendered="{!NOT($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
	                                            <apex:inputField id="iPrepaidFeeValue" value="{!mApplication.Prepaid_Fee__c}"
	                                                             rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
	                                        </div>
	
	
	                                        <!-- Financed Fee -->
	                                        <div id="iFinanceFee" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Finance_Fee__c.Label}</span>
	                                                <apex:outputPanel rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"
	                                                                  styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
	                                            </p>
	                                            <apex:outputField id="iFinanceFeeReadOnly" value="{!mApplication.Finance_Fee__c}" 
	                                                              rendered="{!NOT($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
	                                            <apex:inputField id="iFinanceFeeValue" value="{!mApplication.Finance_Fee__c}"
	                                                             rendered="{!($Permission.Allow_Access_To_Edit_Itemized_Fields)}"/>
	                                        </div>
	
	                                        <!-- Balloon Amount-->
	                                        <div id="iBalloonAmount" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Balloon_Amount__c.Label}</span>
	                                            </p>
	                                            <apex:inputField id="iBalloonAmountValue" value="{!mApplication.Balloon_Amount__c}"/>
	                                        </div>
	
	                                        <!-- Interest Only Term -->
	                                        <div id="iInterestOnlyTerm" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Interest_Only_Term__c.Label}</span>
	                                            </p>
	                                            <apex:inputField id="iInterestOnlyValue" value="{!mApplication.Interest_Only_Term__c}"/>
	                                        </div>
	
	                                        <!-- Interest Start Date -->
	                                        <div id="iInterestStartDate" class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
	                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
	                                                <span class="slds-truncate">{!$ObjectType.Lending_Application__c.Fields.Interest_Accrual_Start_Date__c.Label}</span>
	                                            </p>
	                                            <apex:inputField id="iInterestStartDateValue" value="{!mApplication.Interest_Accrual_Start_Date__c}"/>
	                                        </div>
	
	                                        <!-- show additional fields from field set -->
	                                        <apex:repeat value="{!$ObjectType.Lending_Application__c.FieldSets.Contract_Additional_Edit_Fields}" var="additionalInfo">
		                                        <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
		                                            <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
		                                                <span class="slds-truncate">{!additionalInfo.Label}</span>
	                                                    <apex:outputPanel rendered="{!OR(additionalInfo.required, additionalInfo.dbRequired)}"
	                                                                      styleClass="fs-required slds-m-left_xx-small">*</apex:outputPanel>
		                                            </p>
		                                            <apex:inputField value="{!mApplication[additionalInfo.fieldPath]}" required="false"/>
		                                        </div>
	                                       </apex:repeat>
	                                    </div>
	                                        
                                        <!-- Advance Parameters  -->
                                        <div class="slds-m-top_small">
 		                                    <!-- Change this to collapsible header  -->
 		                                    <c:sectionHeader label="{!$Label.Advance_Preferences_Title}" 
		                                                     isEditSectionHeader="true" isModalWindow="true"/>

		                                    <div id="iAdvancePrefSection">   
		                                        <div class="slds-grid slds-grid_align-spread slds-container_fluid">
		                                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2 slds-p-right_small slds-col_rule-right">
		                                                <apex:outputPanel id="iPredefinedPmtPanel">                                    
		                                                    <c:lendingAppPredefinedPayment applicationId="{!mApplication.Id}"
		                                                                                   predefinedPaymentList="{!mPredefinedPmtObjectList}"
		                                                                                   removedPredefinedPaymentList="{!mRemovedPredefinedPmtList}"
		                                                                                   isApplicable="{!mApplication.Is_Predefined_User_Payments_Allowed__c}"
		                                                                                   titleStyleClass="slds-text-body--regular"/>
		                                                </apex:outputPanel>
		                                            </div>
		                                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2 slds-p-left_small">
		                                                <apex:outputPanel id="iRatePreferencePanel">
		                                                    <c:lendingAppRatePreference applicationId="{!mApplication.Id}"
		                                                                                ratePreferenceList="{!mRatePrefObjectList}"
		                                                                                removedRatePreferenceList="{!mRemovedRatePrefList}"
		                                                                                isApplicable="{!mApplication.Is_Advance_Rate_Preferences_Allowed__c}"
		                                                                                titleStyleClass="slds-text-body--regular"/>
		                                                </apex:outputPanel>
		                                            </div>
		                                        </div>
		
		                                        <div class="slds-m-top_medium">
		                                            <apex:outputPanel id="iPmtPreferencePanel">
		                                                <c:lendingAppPaymentPreference applicationId="{!mApplication.Id}"
		                                                                               paymentPreferenceList="{!mPaymentPrefObjectList}"
		                                                                               removedPaymentPreferenceList="{!mRemovedPaymentPrefList }"
		                                                                               isApplicable="{!mApplication.Is_Advance_Payment_Preferences_Allowed__c}"
		                                                                               titleStyleClass="slds-text-body--regular"/>
		                                            </apex:outputPanel>
		                                        </div>
		
		                                        <!-- Commented by SSingh : To be implemented with Promotion feature -->
		                                        <!--
		                                            <div class="slds-m-top--medium">
		                                                <c:lendingAppHolidayPreference applicationId="{!mApplication.Id}"
		                                                                               holidayPreferenceList="{!mHolidayPrefObjectList}"
		                                                                               removedHolidayPreferenceList="{!mRemovedHolidayPrefList}"
		                                                                               titleStyleClass="slds-text-body--regular"/>
		                                            </div>
		                                        -->
		                                    </div>
                                        </div>
                                        
	                                    <div class="slds-grid slds-grid--align-spread slds-m-top--small">
	                                        <div class="slds-col"></div>
	                                        <div class="slds-col slds-no-flex slds-align-top">
	                                            <apex:commandButton id="calculateButtonBottom" action="{!onCalculate}" 
	                                                                value="{!$Label.fscore__calculate_button}"
	                                                                title="{!$Label.fscore__calculate_button}"
	                                                                reRender="messagePanel,iContractParamDetailPanel,iCalcResultPanel" 
	                                                                status="waitActionStatus"
	                                                                styleClass="slds-button slds-button--brand"
	                                                                oncomplete="onCalculationComplete();"/>
	                                        </div>
	                                    </div>
	
                                        <div class="slds-m-top_small">
					    <c:sectionHeader label="{!$Label.fscore__calculator_result_heading}" 
							     isEditSectionHeader="true" isModalWindow="true"/>

                                            <apex:outputPanel id="iCalcResultPanel">                                    
                                                <div id="iCalcResultSection" class="slds-grid slds-wrap slds-m-horizontal_small">
                                                	<!-- show calculated fields from field set -->
						    <apex:repeat value="{!$ObjectType.Lending_Application__c.FieldSets.Contract_Calculated_Fields}" var="calculatedField">
                                                        <div class="slds-p-horizontal_x-small slds-p-bottom_small slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-truncate">
							    <p class="slds-text-body_small slds-text-color_weak slds-p-bottom_xx-small">
								<span class="slds-truncate">{!calculatedField.Label}</span>
							    </p>
							    <apex:outputField value="{!mApplication[calculatedField.fieldPath]}"/>
							</div>
						    </apex:repeat>
                                                </div>
                                            </apex:outputPanel>
                                        </div>

	                            </apex:outputPanel>
                                </div>
                                <!-- / Tab 2 Contents -->
                                
                                <!-- Tab 3 Contents -->
                                <div id="tab_3_Content" class="slds-tabs_scoped__content slds-hide"
                                     role="tabpanel" aria-labelledby="tab_3_Title">

                                        <apex:outputPanel id="repaymentsPanel">
                                            <c:sectionHeader label="{!$Label.fscore__repayment_schedule_section_title}"
                                                             isEditSectionHeader="true" isModalWindow="true"/>
                                            
                                            <div class="slds-m-horizontal_x-small">
                                                <apex:dataTable id="iRepaySchTable" value="{!mRepayScheduleList}" var="repaySch"
                                                                rendered="{!(mRepayScheduleList.size > 0)}"
                                                                styleClass="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">  
                                                    
                                                    <apex:repeat value="{!$ObjectType.Lending_Application_Repayment_Schedule__c.FieldSets.Repayment_Schedule_List_View_Fields}" var="listViewField">
                                                        <apex:column >
                                                            <apex:facet name="header">
                                                                <span class="slds-text-heading--x-small slds-truncate">
                                                                    <strong>{!listViewField.Label}</strong>
                                                                </span>
                                                            </apex:facet>
                                                            <apex:outputField value="{!repaySch[listViewField.fieldPath]}" styleClass="slds-truncate"/>
                                                        </apex:column>
                                                    </apex:repeat>
                                                    
                                                </apex:dataTable>
                                                
                                                <apex:outputPanel rendered="{!(mRepayScheduleList.size == 0)}">
                                                    <div class="slds-align--absolute-center">
                                                        <span class="slds-text-body--regular">{!$Label.fscore__no_record_to_display}</span>
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                        
                                            <div class="slds-m-top_small">
			                                    <c:sectionHeader label="{!$Label.fscore__repayment_detail_section_title}"
			                                                     isEditSectionHeader="true" isModalWindow="true"/>
                                            </div>
                                            
		                                    <div class="slds-m-horizontal_x-small">
		                                        <div class="slds-scrollable_y">
		                                            <div style="max-height:640px">
		                                                <apex:dataTable id="iRepaymentDtlTable" value="{!mRepaymentList}" var="repayDtl"
		                                                                rendered="{!(mRepaymentList.size > 0)}"
		                                                                styleClass="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">  
		                                
		                                                    <apex:repeat value="{!$ObjectType.Lending_Application_Repayment_Detail__c.FieldSets.Repayment_List_View_Fields}"
		                                                                 var="listViewField">
		                                                        <apex:column >
		                                                            <apex:facet name="header">
		                                                                <span class="slds-text-heading--x-small slds-truncate slds-cell-wrap">
		                                                                    <strong>{!listViewField.Label}</strong>
		                                                                </span>
		                                                            </apex:facet>
		                                                            <apex:outputField value="{!repayDtl[listViewField.fieldPath]}" html-class="slds-cell-wrap"/>
		                                                        </apex:column>
		                                                    </apex:repeat>
		                                
		                                                </apex:dataTable>
		                                            </div>                       
		                                        </div>
		                                        
		                                        <apex:outputPanel rendered="{!(mRepaymentList.size == 0)}">
		                                            <div class="slds-box slds-box--x-small slds-container--fluid"
		                                                 style="border-radius: 0; border-left: 0; border-right: 0;">
		                                                <div align="center">
		                                                    <span class="slds-text-body--regular">{!$Label.No_Record_To_Display}</span>
		                                                </div>
		                                            </div>
		                                        </apex:outputPanel>
		                                    </div>
                                        
                                        </apex:outputPanel>

                                </div>
                                <!-- / Tab 3 Contents -->
                            </div>
        
                        </apex:pageBlock>
                    </apex:outputPanel>
                </div>
            </apex:form>
            <!-- / Wizard Step Body -->

            <!-- Footer -->
            <c:fsCopyright pageTitle="{!mPageTitle} - {!mPageSubTitle}"/>
            <!-- / Footer -->
        </div>
        
        <script src="{!URLFOR($Resource.fs_slds_tabs_js, 'fs_slds_tabs_js.js')}"/>
        <c:fsModalWindow />
            
        <script>
            $j(document).ready( function() {
                setFieldDisplayProperties();
            });
            
            function onCalculationComplete(){
                setFieldDisplayProperties();
                navigateToResult();
            }
            
            function setFieldDisplayProperties(){
                var selectedCalcParam = $j("select[id$=iSelectedCalcParam").find(":selected").val();
                
                $j("input[id$=iFinancedAmountValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iRateValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iTermValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iPaymentAmountValue]").prop("style", "background-color: #ffffff !important;");
                $j("input[id$=iBalloonAmountValue]").prop("style", "background-color: #ffffff !important;");
    
                $j("span[id$=iFinancedAmountRequired]").prop("style", "display: inline;");
                $j("span[id$=iRateRequired]").prop("style", "display: inline;");
                $j("span[id$=iTermRequired]").prop("style", "display: inline;");
                $j("span[id$=iPaymentAmountRequired]").prop("style", "display: inline;");
            
                if (selectedCalcParam === 'FinancedAmount'){
                    $j("input[id$=iFinancedAmountValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iFinancedAmountRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Rate'){
                    $j("input[id$=iRateValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iRateRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Term'){
                    $j("input[id$=iTermValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iTermRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Payment'){
                    $j("input[id$=iPaymentAmountValue]").prop("style", "background-color: #eaecef !important;");
                    $j("span[id$=iPaymentAmountRequired]").prop("style", "display: none;");
                }
                else if (selectedCalcParam === 'Balloon'){
                    $j("input[id$=iBalloonAmountValue]").prop("style", "background-color: #eaecef !important;");
                }
            }
            
            function navigateToResult(){
                $j("li[id$=calculationResultTab]").click();
            }

        </script>
    </body>
</apex:page>
