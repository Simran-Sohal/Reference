<apex:page id="batchJobMonitorPage" controller="BatchJobMonitorController" docType="html-5.0">
    <style>
        .fs-input-date-field{
            height: 1.75rem !important;
            width: 49% !important;
            border: 1px solid #b2b2b2 !important;
            border-radius: .25rem !important;
        }
    </style>
    
    <div id="monitorBatchPage">
        <apex:form id="batchJobMonitorForm" styleClass="fs-data-form slds-form--horizontal">

            <apex:outputPanel id="messagePanel" styleClass="fs-message-panel">
                <apex:pageMessages />
            </apex:outputPanel>
            
            <apex:actionStatus id="waitStatus">
                <apex:facet name="start">
                    <c:fsSpinner spinnerSize="medium"/>
                </apex:facet>
            </apex:actionStatus>
                
            <!-- Search Options Panel -->
            <div class="slds-box slds-box--x-small slds-theme--default slds-container--fluid slds-m-bottom--small"> 
                <c:sectionHeader label="{!$Label.fscore__monitor_batch_jobs_title}"
                                 isEditSectionHeader="true" isModalWindow="true"/>

                <apex:pageBlock id="monitorBatchJobSearchBlock" mode="maindetail" html-class="fs-data-block">

                    <div id="iBatchJobMonitorSearchSection" class="slds-m-top--small">
                        <div class="slds-grid slds-wrap slds-container--medium slds-container--left">
                            <div id="iSearchByOptionField" class="slds-col slds-col--padded slds-align-top slds-form-element 
                                                                  slds-large-size--1-of-1 slds-medium-size--1-of-1 slds-small-size--1-of-1 
                                                                  slds-is-required" >
                                
                                <label for="iSearchByOptionValue" class="slds-form-element__label"><strong>{!$Label.Batch_Job_Search_By_Title}</strong></label>
                                <div class="slds-form-element__control">
                                    <apex:selectList id="iSearchOptionValue" value="{!mSearchByOption}"
                                                     multiselect="false" size="1"
                                                     style="width: 49% !important;"
                                                     onchange="searchOptionChangeHandler();">
                                        <apex:selectOptions value="{!mSearchByList}" />
                                    </apex:selectList>
                                </div>
                            </div>
                            
                            <div id="iSearchByDateField" class="slds-col slds-col--padded slds-align-top slds-form-element 
                                                                slds-large-size--1-of-1 slds-medium-size--1-of-1 slds-small-size--1-of-1" >
                                <label for="iSearchByDateValue" class="slds-form-element__label">
                                    <strong>{!$Label.Batch_Job_Search_Date_Title}</strong>
                                </label>
                                <div class="slds-form-element__control">
                                    <apex:input id="iSearchByDateValue" value="{!mSearchByDate}"
                                                type="date" styleClass="datepicker slds-select fs-input-date-field"
                                                onfocus="DatePicker.pickDate(true, '{!$Component.iSearchDateValue}', false);"/>
                                </div>
                            </div>
                            
                            <div id="iSearchByJobIdField" class="slds-col slds-col--padded slds-align-top slds-form-element 
                                                                 slds-large-size--1-of-1 slds-medium-size--1-of-1 slds-small-size--1-of-1" >
                                <label for="iSearchByJobIdValue" class="slds-form-element__label">
                                    <strong>{!$Label.Batch_Job_Id_Title}</strong>
                                </label>
                                <div class="slds-form-element__control">
                                    <apex:inputText id="iSearchByJobIdValue" value="{!mSearchByJobId}" style="width: 49% !important;"
                                                    html-placeholder="{!$Label.fscore__batch_job_enter_id_placeholder}"/>
                                </div>
                            </div>
                            
                            <div id="iSortByField" class="slds-grid slds-col slds-col--padded slds-align-top slds-form-element slds-large-size--1-of-1 slds-medium-size--1-of-1 slds-small-size--1-of-1" >
                                <label for="iSortByOption" class="slds-form-element__label">
                                    <strong>{!$Label.Batch_Job_Sort_By_Title}</strong>
                                </label>&nbsp;&nbsp;
                                <div class="slds-form-element__control">
                                    <div class="slds-grid slds-grid--align-center">
                                        <apex:selectList id="iSortByOption" value="{!mSortByFieldName}"
                                                         multiselect="false" size="1">
                                            <apex:selectOptions value="{!mSortByList}"/>
                                        </apex:selectList>&nbsp;&nbsp;
                                        <apex:selectList value="{!mOrder}" multiselect="false" size="1">
                                            <apex:selectOptions value="{!mOrderList}"/>
                                        </apex:selectList>
                                    </div>
                                </div>    
                            </div>
                        </div>
                    </div>

                    <apex:pageBlockButtons location="bottom" style="float: right;">
                        <apex:commandButton styleClass="slds-button slds-button--brand" 
                                            action="{!onRefresh}" status="waitStatus"
                                            title="{!$Label.fscore__refresh_button_tooltip}"
                                            value="{!$Label.fscore__refresh_button}"
                                            reRender="messagePanel,batchJobListPanel,paginationPanel"/>
                                        
                        <apex:commandButton styleClass="slds-button slds-button--neutral" 
                                            action="{!onReset}" status="waitStatus"
                                            title="{!$Label.fscore__reset_button_tooltip}"
                                            value="{!$Label.fscore__reset_button}"
                                            reRender="batchJobMonitorForm"
                                            oncomplete="searchOptionChangeHandler()"/>
                    </apex:pageBlockButtons>
                </apex:pageBlock>
            </div> 
            <!-- / Search Options Panel -->
            
            <!-- Search Result Panel -->
            <apex:outputPanel id="batchJobListPanel">
                <div class="slds-box slds-box--x-small slds-theme--shade slds-container--fluid"> 
                    <div class="slds-grid slds-grid--align-spread">
                        <div class="slds-col">
                            <div class="slds-media">
                                <div class="slds-media__body slds-align-middle slds-p-left--xx-small">
                                    <h3 class="slds-text-body--regular">
                                        <strong><span style="font-size:14px;">{!$Label.fscore__batch_job_list_view_title}</span></strong>
                                    </h3>
                                </div>
                            </div>
                        </div>                
                    </div>
                
                    <apex:outputPanel rendered="{!NOT(mIsBatchJobListEmpty)}">
                        <div class="slds-m-vertical--x-small">
                            <apex:dataTable id="batchJobListTable" value="{!mBatchJobDetailList}" var="batchJob"
                                            styleClass="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__action_column_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:commandLink value="{!$Label.fscore__view_link_title}" onclick="OpenModalView('/apex/fscore__batchJobDetailViewPage?id={!batchJob.mBatchJob.Id}','Large');"
                                                      reRender="batchJobListPanel"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_id_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputField value="{!batchJob.mBatchJob.Id}"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_submitted_date_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputField value="{!batchJob.mBatchJob.CreatedDate}"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_submitted_by_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputField value="{!batchJob.mBatchJob.CreatedBy.Name}"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_type_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputField value="{!batchJob.mBatchJob.JobType}"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_apex_class_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputField value="{!batchJob.mBatchJob.ApexClass.Name}"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_completed_date_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputField value="{!batchJob.mBatchJob.CompletedDate}"/>
                                </apex:column> 
                                
                                <apex:column > 
                                    <apex:facet name="header">
                                        <span class="slds-text-heading--x-small slds-truncate">
                                            <strong>{!$Label.fscore__batch_job_status_title}</strong>
                                        </span>
                                    </apex:facet>
                                    <apex:outputPanel style="color:{!IF(AND(NOT(ISBLANK(batchJob.mExtendedStatus)), OR(batchJob.mExtendedStatus == 'Error', batchJob.mBatchJob.Status == 'Aborted', batchJob.mBatchJob.Status == 'Failed')), '#d54937', '#4bca81')};">
                                        <apex:outputField value="{!batchJob.mBatchJob.Status}"/>
                                        <apex:outputText value=" - " rendered="{!NOT(ISBLANK(batchJob.mExtendedStatus))}"/>
                                        <apex:outputText value="{!batchJob.mExtendedStatus}"/>
                                    </apex:outputPanel>
                                </apex:column> 
                            </apex:dataTable>
                        </div>
                        
                        <apex:outputPanel id="paginationPanel">
                            <div class="slds-grid slds-grid--align-spread">
                                <div id="recordSize">
                                    <apex:outputText value="{!$Label.fscore__display_title}"/>&nbsp;&nbsp;
                                    
                                    <apex:selectList id="recordSetSize" value="{!mRecordSetSize}"
                                                     multiselect="false" size="1"
                                                     style="width: auto !important;">
                                        <apex:selectOptions value="{!mRecordSetSizeList}"/>
                                        <apex:actionSupport event="onchange" action="{!onRecordSizeChange}" status="recordSizeChange"
                                                            reRender="paginationPanel,batchJobListPanel"/>
                                    </apex:selectList>&nbsp;&nbsp;
                                    
                                    <apex:outputText value="{!$Label.fscore__records_per_page_title}"/>&nbsp;      
                                    
                                    <apex:actionStatus id="recordSizeChange">
                                        <apex:facet name="start">
                                            <apex:image styleClass="slds-spinner--small"
                                                        url="{!URLFOR($Resource.fs_slds,'/assets/images/spinners/slds_spinner_brand.gif')}" />
                                        </apex:facet>
                                    </apex:actionStatus>
                                </div>
                                <div id="pagination">
                                    <apex:commandButton value="<" action="{!previous}" disabled="{!disablePrevious}"
                                                        styleClass="slds-button {!IF(disablePrevious, 'fs-small-button--disabled', 'fs-small-button--neutral')}"
                                                        reRender="paginationPanel,batchJobListPanel"/>&nbsp;&nbsp;        
                                    <apex:outputText value="{!mCurrentPage} {!$Label.fscore__page_of_title} {!mTotalPages}"></apex:outputText>&nbsp;
                                    <apex:commandButton value=">" action="{!next}" disabled="{!disableNext}" 
                                                        styleClass="slds-button {!IF(disableNext, 'fs-small-button--disabled', 'fs-small-button--neutral')}"
                                                        reRender="paginationPanel,batchJobListPanel"/>
                                </div>
                            </div>
                        </apex:outputPanel>
                    </apex:outputPanel>

                    <apex:outputPanel rendered="{!mIsBatchJobListEmpty}">
                        <div class="slds-m-bottom--x-small" align="center">
                            <span class="slds-text-body--regular">{!$Label.No_Record_To_Display}</span>
                        </div>
                    </apex:outputPanel>
                </div>            
            </apex:outputPanel>
        </apex:form>
    </div>
    
    <script type="text/javascript">
    var $j = jQuery.noConflict();
    
    $j(document).ready( function() {
        hideSearchOptions();
    });
    
    function hideSearchOptions(){
        $j("#iSearchByDateField").hide();
        $j("#iSearchByJobIdField").hide();
    }
    
    function searchOptionChangeHandler(){
        hideSearchOptions();
        var searchByOption = $j("select[id$=iSearchOptionValue]").val();
        console.log(searchByOption);
        
        var searchByOptionValue = searchByOption.toLowerCase();
        if (searchByOptionValue == "specificdate"){
            $j("#iSearchByDateField").show();
        }
        else if (searchByOptionValue == "specificjob"){
            $j("#iSearchByJobIdField").show();
        }
    }
    </script>
    
</apex:page>
