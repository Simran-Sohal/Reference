<apex:page id="pricingOfferEditPage" standardController="Lending_Application_Pricing_Offer__c"
           extensions="PricingOfferEditController" tabStyle="Lending_Application_Pricing_Offer__c"
           showHeader="true" sidebar="true" applyHtmlTag="true" docType="html-5.0"
           title="{!$Label.fscore__edit_lending_app_pricing_title}"  >

    <head>
        <apex:slds />
        <apex:stylesheet value="{!URLFOR($Resource.fs_style, 'fs-style.css')}"/>
        <meta http-equiv="x-ua-compatible" content="ie=edge"/>
        <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"/>
        <script src="{!URLFOR($Resource.fs_svg, 'svg4everybody.js')}"></script>
        <script>
            svg4everybody();
            var $j = jQuery.noConflict();
        </script>
    </head>   

    <body>   
        <div class="slds-scope">
            <apex:form id="pricingEditForm" styleClass="slds-form_horizontal fs-data-form slds-m-horizontal_x-small slds-m-bottom_large">

                <div id="page-sticky-anchor"></div>
                <div id="page-sticky-header">
                    <div class="slds-page-header slds-m-bottom--small" role="banner">
                        <div class="slds-grid slds-grid--align-spread" >
                            <div class="slds-col " align="left">
                                <div class="slds-media">
                                    <div class="slds-media__figure">
                                        <c:svgIcon iconStyleClass="slds-icon slds-icon--large slds-icon-standard-apps"
                                                   iconPath="{!URLFOR($Asset.SLDS, 'assets/icons/custom-sprite/svg/symbols.svg#custom18')}"/>
                                    </div>
                                    <div class="slds-media__body slds-align-middle">
                                        <p class="slds-text-heading--label">{!mApplication.Name}</p>
                                        <h1  class="slds-page-header__title slds-m-right--small slds-truncate slds-align-middle">
                                            {!IF(ISBLANK(mPricing.Id), $Label.fscore__new_lending_app_pricing_title, ($ObjectType.Lending_Application_Pricing_Offer__c.Fields.Name.Label + mPricing.Name))}
                                        </h1>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="slds-col slds-no-flex slds-align-middle">
                                <apex:commandButton action="{!onCalculate}" 
                                                    value="{!$Label.fscore__calculate_button}" 
                                                    title="{!$Label.fscore__calculate_button}"
                                                    styleClass="slds-button slds-button--brand"
                                                    status="waitActionStatus"
                                                    reRender="messagePanel,pricingInfoPanel,pricingParamPanel,calcResultPanel,repaymentPanel"/>
                                
                                <apex:commandButton value="{!$Label.fscore__save_button}" 
                                                    title="{!$Label.fscore__save_button_tooltip}"
                                                    styleClass="slds-button slds-button--brand"
                                                    action="{!onSave}" 
                                                    status="waitActionStatus"
                                                    reRender="messagePanel,pricingBlockPanel,pricingInfoPanel,pricingParamPanel,calcResultPanel,repaymentPanel"/>
                                                    
                                <apex:commandButton immediate="true" action="{!cancel}"
                                                    value="{!$Label.fscore__cancel_button}" 
                                                    title="{!$Label.fscore__cancel_button_tooltip}"
                                                    styleClass="slds-button slds-button--neutral"/>
                            </div>
                        </div>
                    </div>
                </div>
                
                <apex:actionStatus id="waitActionStatus">
                    <apex:facet name="start">
                        <c:fsSpinner spinnerSize="medium"/>
                    </apex:facet>
                </apex:actionStatus>

                <apex:outputPanel id="messagePanel" styleClass="fs-message-panel">
                    <apex:pagemessages />
                </apex:outputPanel>          

                <div class="slds-container_fluid slds-m-top_small">
                    <apex:outputPanel id="pricingBlockPanel">
                        <apex:pageBlock id="pricingPageBlock" mode="mainDetail" html-class="fs-data-block">
                                
                        <div id="pricingTabPanel" class="slds-tabs_scoped">
                            <ul class="slds-tabs_scoped__nav" role="tablist">
                                <!-- Tab 1 Title -->
                                <li class="slds-tabs_scoped__item slds-text-heading_label slds-active" role="presentation">
                                    <a id="tab_1_Title" class="slds-tabs_scoped__link" href="#void" role="tab" 
                                       tabindex="0" aria-selected="true" aria-controls="tab_1_Content" >
                                        {!$Label.Pricing_Tab_Title}
                                    </a>
                                </li>
                                <!-- / Tab 1 Title -->

                                <!-- Tab 2 Title -->
                                <li class="slds-tabs_scoped__item slds-text-heading_label"
                                    role="presentation">
                                    <a id="tab_2_Title" class="slds-tabs_scoped__link" href="#void" role="tab" 
                                       tabindex="-1" aria-selected="false" aria-controls="tab_2_Content" >
                                        {!$Label.Repayment_Tab_Title}
                                    </a>
                                </li>
                                <!-- / Tab 2 Title -->
                            </ul>

                            <!-- Tab 1 Contents -->
                            <div id="tab_1_Content" class="slds-tabs_scoped__content slds-show"
                                 role="tabpanel" aria-labelledby="tab_1_Title">
                                <apex:outputPanel id="pricingInfoPanel">
                                    <c:sectionHeader label="{!$Label.fscore__information_block_title}"
                                                     isEditSectionHeader="true" isModalWindow="true"/>
                                    
                                    <apex:pageBlockSection id="pricingInfoSection" columns="2" collapsible="false" html-class="slds-theme--default">
                                        <!-- Pricing List -->
                                        <apex:pageBlockSectionItem id="iPricingName">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Pricing_Name__c.Label}">
                                                <apex:outputPanel styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                            </apex:outputLabel>
                                    
                                            <c:actionSelectList value="{!mPricing.Pricing_Name__c}"
                                                                selectOptions="{!mPricingSelectList}"
                                                                changeAction="{!onPricingChange}"
                                                                enableChangeAction="true"
                                                                enableRefreshAction="false"
                                                                reRender="messagePanel,pricingInfoPanel,pricingParamPanel,calcResultPanel,repaymentPanel"/>
                                        </apex:pageBlockSectionItem>
                                        <!-- / Pricing List -->

                                        <!-- Pricing Date -->
                                        <apex:pageBlockSectionItem id="iPricingDate">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Pricing_Date__c.Label}">
                                                <apex:outputPanel styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel>
                                            </apex:outputLabel>
                                            
                                            <apex:inputField value="{!mPricing.Pricing_Date__c}">
                                                <apex:actionSupport event="onchange" action="{!onPricingDateChange}"
                                                                    status="waitActionStatus" reRender="pricingBlockPanel" />
                                            </apex:inputField>
                                        </apex:pageBlockSectionItem>
                                        <!-- / Pricing Date -->
    
                                        <apex:pageBlockSectionItem id="iPricingRate">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Pricing_Rate__c.Label}"></apex:outputLabel>
                                            <apex:outputPanel >
                                                <apex:outputField value="{!mPricing.Pricing_Rate__c}"/>&nbsp;&nbsp;
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="(" />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!$Label.fscore__minimum_value_title} " />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!mPricing.Rate_Minimum__c}" />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value=" - " />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!$Label.fscore__maximum_value_title} " />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!mPricing.Rate_Maximum__c}" />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Rate__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value=")" />
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
    
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Index_Name__c.Label}"></apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Index_Name__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <apex:pageBlockSectionItem rendered="{!NOT(ISBLANK(mPricing.Index_Name__c))}">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Index_Rate__c.Label}"></apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Index_Rate__c}"/>
                                        </apex:pageBlockSectionItem>
                                        <apex:pageBlockSectionItem rendered="{!NOT(ISBLANK(mPricing.Index_Name__c))}">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Margin_Rate__c.Label}"></apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Margin_Rate__c}"/>
                                        </apex:pageBlockSectionItem>

                                        <apex:pageBlockSectionItem id="iPricingTerm">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Pricing_Term__c.Label}"></apex:outputLabel>
                                            <apex:outputPanel >
                                                <apex:outputField value="{!mPricing.Pricing_Term__c}"/>&nbsp;&nbsp;
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="(" />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!$Label.fscore__minimum_value_title} " />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!mPricing.Term_Minimum__c}"/>
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value=" - " />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!$Label.fscore__maximum_value_title} " />
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value="{!mPricing.Term_Maximum__c}"/>
                                                <apex:outputText rendered="{!(mPricing.Pricing_Term__c != null)}" style="color: #97a3ad !important; font-size: 11px !important;" value=")" />
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
    
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Buy_Rate__c.Label}"></apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Buy_Rate__c}"/>
                                        </apex:pageBlockSectionItem>
   
                                    </apex:pageBlockSection>
                                </apex:outputPanel>                            
    
                                <apex:outputPanel id="pricingParamPanel">
                                    <div class="slds-m-top--small">
                                        <div class="slds-grid slds-grid--align-spread slds-m-bottom--small fs-edit-section-header"
                                             style="background-color: #f3f2f2 !important;">
                                            <div class="slds-col slds-align-middle">
                                                <h3><span style="color: #16325c;">
                                                        <strong>{!$Label.fscore__pricing_param_section_title}</strong>
                                                    </span>
                                                </h3>
                                            </div>
                                            
                                            <div class="slds-col slds-no-flex slds-align-middle">
                                                <apex:selectList id="iSelectedCalcParam" multiselect="false" size="1"
                                                                 value="{!mCalculateOption}"
                                                                 title="{!$Label.fscore__calculate_option_tooltip}"
                                                                 style="width: 100% !important;"
                                                                 styleClass="slds-m-horizontal--xx-small">
                                                     <apex:selectOptions value="{!mCalculateOptionList}"/>
                                                     <apex:actionSupport event="onchange" status="waitActionStatus" reRender="messagePanel,pricingParamPanel"/>
                                                </apex:selectList>
                                            </div>
                                        </div>
                                    </div>
    
                                    <apex:pageBlockSection id="pricingParamSection" columns="2" collapsible="false" html-class="slds-theme--default">
                                        <!-- Financed Amount -->
                                        <apex:pageBlockSectionItem id="iFinancedAmount">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Financed_Amount__c.Label}">
                                                <apex:outputPanel id="iFinancedAmountRequired" rendered="{!NOT(mCalculateOption == 'FinancedAmount')}"
                                                                  styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            
                                            <apex:inputField id="iFinancedAmountValue" value="{!mPricing.Financed_Amount__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Rate -->
                                        <apex:pageBlockSectionItem id="iRate">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Rate__c.Label}">
                                                <apex:outputPanel id="iRateRequired" rendered="{!NOT(mCalculateOption == 'Rate')}"
                                                                  styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            
                                            <apex:inputField id="iRateValue" value="{!mPricing.Rate__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Term -->
                                        <apex:pageBlockSectionItem id="iTerm">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Term__c.Label}">
                                                <apex:outputPanel id="iTermRequired" rendered="{!NOT(mCalculateOption == 'Term')}"
                                                                  styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            
                                            <apex:inputField id="iTermValue" value="{!mPricing.Term__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Payment Frequency-->
                                        <apex:pageBlockSectionItem id="iPaymentFrequency">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Payment_Frequency__c.Label}">
                                                <apex:outputPanel id="iPaymentFrequencyRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            
                                            <apex:inputField id="iPaymentFrequencyValue" value="{!mPricing.Payment_Frequency__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Start Date -->
                                        <apex:pageBlockSectionItem id="iStartDate">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Start_Date__c.Label}">
                                                <apex:outputPanel id="iStartDateRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            
                                            <apex:inputField id="iStartDateValue" value="{!mPricing.Start_Date__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Payment Start Date -->
                                        <apex:pageBlockSectionItem id="iPaymentStartDate">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Payment_Start_Date__c.Label}">
                                                <apex:outputPanel id="iPmtStartDateRequired" styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            <apex:inputField value="{!mPricing.Payment_Start_Date__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Payment Amount-->
                                        <apex:pageBlockSectionItem id="iPaymentAmount">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Payment_Amount__c.Label}">
                                                <apex:outputPanel id="iPaymentAmountRequired" rendered="{!NOT(mCalculateOption == 'Payment')}"
                                                                  styleClass="fs-required slds-m-left--xxx-small">*</apex:outputPanel> 
                                            </apex:outputLabel>
                                            
                                            <apex:inputField id="iPaymentAmountValue" value="{!mPricing.Payment_Amount__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <!-- Balloon Amount-->
                                        <apex:pageBlockSectionItem id="iBalloonAmount">
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Balloon_Amount__c.Label}"></apex:outputLabel>
                                            
                                            <apex:inputField id="iBalloonAmountValue" value="{!mPricing.Balloon_Amount__c}"/>
                                        </apex:pageBlockSectionItem>                                    
                                        
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Interest_Only_Term__c.Label}">
                                            </apex:outputLabel>
                                            <apex:inputField value="{!mPricing.Interest_Only_Term__c}"/>
                                        </apex:pageBlockSectionItem>
                                        
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Term_Monthly__c.Label}">
                                            </apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Term_Monthly__c}" />
                                        </apex:pageBlockSectionItem>
                                        
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Prepaid_Fee__c.Label}">
                                            </apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Prepaid_Fee__c}" />
                                        </apex:pageBlockSectionItem>

                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="{!$ObjectType.Lending_Application_Pricing_Offer__c.Fields.Finance_Fee__c.Label}">
                                            </apex:outputLabel>
                                            <apex:outputField value="{!mPricing.Finance_Fee__c}" />
                                        </apex:pageBlockSectionItem>
                                    </apex:pageBlockSection>
                                </apex:outputPanel>                            
    
                                <apex:outputPanel id="calcResultPanel">
                                    <div class="slds-m-top--small">
                                        <c:sectionHeader label="{!$Label.fscore__calculator_result_heading}"
                                                         isEditSectionHeader="true" isModalWindow="true"/>
                                    </div>
    
                                    <apex:pageBlockSection id="calcResultSection" columns="2" collapsible="false" html-class="slds-theme--default">
                                        <apex:repeat value="{!IF(mApplication.Product_Family__c == 'Lease', $ObjectType.Calculator__c.FieldSets.Lease_Calc_Result_Fields
                                                                ,$ObjectType.Calculator__c.FieldSets.Loan_Calc_Result_Fields)}" var="result">

                                            <apex:pageBlockSectionItem >
                                                <apex:outputLabel value="{!result.Label}"></apex:outputLabel>
                                                <apex:outputField value="{!mCalcResult[result.fieldPath]}"/>
                                            </apex:pageBlockSectionItem>
                                        </apex:repeat>
                                    </apex:pageBlockSection>
                                </apex:outputPanel>
                            </div>
                            <!-- / Tab 1 Contents -->
                            
                            <!-- Tab 2 Contents -->
                            <div id="tab_2_Content" class="slds-tabs_scoped__content slds-hide"
                                 role="tabpanel" aria-labelledby="tab_2_Title">
                                <apex:outputPanel id="repaymentPanel">
                                    <c:sectionHeader label="{!$Label.fscore__repayment_detail_section_title}"
                                                     isEditSectionHeader="true" isModalWindow="true"/>
    
                                    <div class="slds-m-horizontal--x-small">
                                        <div class="slds-scrollable--y">
                                            <div style="max-height:640px">
                                                <apex:dataTable id="iRepaymentDtlTable" value="{!mRepaymentList}" var="repayDtl"
                                                                rendered="{!(mRepaymentList.size > 0)}"
                                                                styleClass="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">  
                                
                                                    <apex:repeat value="{!$ObjectType.Calculator_Repayment_Detail__c.FieldSets.Repayment_List_View_Fields}"
                                                                 var="listViewField">
                                                        <apex:column >
                                                            <apex:facet name="header">
                                                                <span class="slds-text-heading--x-small slds-truncate slds-cell-wrap">
                                                                    <strong>{!listViewField.Label}</strong>
                                                                </span>
                                                            </apex:facet>
                                                            <apex:outputField value="{!repayDtl[listViewField.fieldPath]}" html-class="slds-cell-wrap"/>
                                                        </apex:column>
                                                    </apex:repeat>
                                
                                                </apex:dataTable>
                                            </div>                       
                                        </div>
                                        
                                        <apex:outputPanel rendered="{!(mRepaymentList.size == 0)}">
                                            <div class="slds-box slds-box--x-small slds-container--fluid"
                                                 style="border-radius: 0; border-left: 0; border-right: 0;">
                                                <div align="center">
                                                    <span class="slds-text-body--regular">{!$Label.No_Record_To_Display}</span>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                    </div>
                               </apex:outputPanel>                            
                            </div>
                            <!-- / Tab 2 Contents -->
                        </div>
    
                        </apex:pageBlock>
                    </apex:outputPanel>
                </div>
            </apex:form>
            <c:fsCopyright pageTitle="{!IF(ISBLANK(mPricing.Id), $Label.fscore__new_lending_app_pricing_title, ($ObjectType.Lending_Application_Pricing_Offer__c.Fields.Name.Label + mPricing.Name))}"/>
        </div>

        <script src="{!URLFOR($Resource.fs_sticky_header, 'fs_sticky_header.js')}"/>
        <script src="{!URLFOR($Resource.fs_slds_tabs_js, 'fs_slds_tabs_js.js')}"/>
        <script>
            //This method overrides the standard salesforce setFocusOnLoad so that
            //when the page opens the focus should not go to the date field
            function setFocusOnLoad() {}
        </script>            
    </body>
</apex:page>
